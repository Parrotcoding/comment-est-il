<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Comment est-il?</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- HIDE PAGE UNTIL KILLSWITCH CHECK -->
<style>
    html { visibility: hidden; }
</style>

<!-- EARLY KILLSWITCH CHECK -->
<script>
(async function () {
    const KILLSWITCH_URL =
        "https://example.com";

    try {
        const res = await fetch(KILLSWITCH_URL, { cache: "no-store" });
        const text = (await res.text()).trim();

        if (text === "yes") {
            document.open();
            document.write(`
<!DOCTYPE html>
<html>
<head>
<title>Internal Server Error</title>
<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: system-ui, sans-serif;
    background: #ffffff;
}
</style>
</head>
<body>
<div style="text-align:center">
    <h1>Internal Server Error</h1>
    <p>Try again later</p>
</div>
</body>
</html>
            `);
            document.close();
            return;
        }
    } catch (e) {
        /* fail open */
    }

    // allow page to render
    document.documentElement.style.visibility = "visible";
})();
</script>

<style>
    body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: linear-gradient(135deg, #c7e9ff, #ffc2c2, #ffffff);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .player {
        width: 360px;
        background: #ffffffcc;
        backdrop-filter: blur(20px);
        border-radius: 26px;
        padding: 26px;
        text-align: center;
        box-shadow: 0 10px 35px rgba(0,0,0,0.15);
    }

    .cover {
        width: 230px;
        height: 230px;
        margin: 0 auto 20px;
        border-radius: 22px;
        background: linear-gradient(135deg, #89cff0, #ffb3b3);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    h2 {
        margin: 12px 0 20px;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .controls {
        margin-top: 18px;
        display: flex;
        justify-content: center;
        gap: 24px;
        font-size: 2.3rem;
        align-items: center;
    }

    .controls span {
        cursor: pointer;
        user-select: none;
        transition: 0.15s;
    }

    .controls span:hover {
        transform: scale(1.17);
        opacity: 0.8;
    }

    .loop.active {
        color: #22c55e;
    }

    .progress-container {
        width: 100%;
        margin-top: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.8rem;
        color: #444;
    }

    input[type="range"] {
        flex: 1;
        -webkit-appearance: none;
        height: 6px;
        border-radius: 4px;
        background: #ddd;
        outline: none;
        cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 14px;
        height: 14px;
        background: #4f46e5;
        border-radius: 50%;
        cursor: pointer;
    }

    #status {
        margin-top: 14px;
        font-size: 0.85rem;
        color: #666;
    }
</style>
</head>

<body>

<div class="player">
    <div class="cover"></div>

    <h2>Comment est-il?</h2>

    <div class="controls">
        <span id="playPauseBtn">▶</span>
        <span id="loopBtn" class="loop">⟳</span>
    </div>

    <div class="progress-container">
        <span id="current">0:00</span>
        <input type="range" id="seek" value="0" min="0" max="100">
        <span id="duration">0:00</span>
    </div>

    <a href="https://github.com/Parrotcoding/comment-est-il/raw/refs/heads/main/audio.mp3">
        Download audio file Here
    </a>

    <div id="status">Ready</div>
</div>

<audio id="audio" src="audio.mp3"></audio>

<script>
    const audio = document.getElementById("audio");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const loopBtn = document.getElementById("loopBtn");
    const status = document.getElementById("status");
    const seek = document.getElementById("seek");
    const current = document.getElementById("current");
    const duration = document.getElementById("duration");

    function formatTime(sec) {
        sec = Math.floor(sec);
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${m}:${s.toString().padStart(2, '0')}`;
    }

    audio.onloadedmetadata = () => {
        duration.textContent = formatTime(audio.duration);
    };

    playPauseBtn.onclick = () => {
        if (audio.paused) {
            audio.play();
            playPauseBtn.textContent = "▐▐";
            status.textContent = "Playing";
        } else {
            audio.pause();
            playPauseBtn.textContent = "▶";
            status.textContent = "Paused";
        }
    };

    loopBtn.onclick = () => {
        audio.loop = !audio.loop;
        loopBtn.classList.toggle("active", audio.loop);
        status.textContent = audio.loop ? "Looping" : "Loop Off";
    };

    audio.ontimeupdate = () => {
        seek.value = (audio.currentTime / audio.duration) * 100;
        current.textContent = formatTime(audio.currentTime);
    };

    seek.oninput = () => {
        audio.currentTime = (seek.value / 100) * audio.duration;
    };

    audio.onended = () => {
        if (!audio.loop) {
            playPauseBtn.textContent = "▶";
            status.textContent = "Finished";
        }
    };

    /* ================= KILLSWITCH (RUNTIME) ================= */

    const KILLSWITCH_URL =
        "https://zwfucjsugrbjmcwhhcnj.supabase.co/functions/v1/status";

    let killed = false;

    function triggerKillSwitch() {
        if (killed) return;
        killed = true;

        document.body.innerHTML = "";
        document.body.style.margin = "0";
        document.body.style.display = "flex";
        document.body.style.justifyContent = "center";
        document.body.style.alignItems = "center";
        document.body.style.height = "100vh";
        document.body.style.fontFamily = "system-ui, sans-serif";
        document.body.style.background = "#ffffff";

        document.body.innerHTML = `
            <div style="text-align:center">
                <h1>Internal Server Error</h1>
                <p>Try again later</p>
            </div>
        `;
    }

    async function checkKillSwitch() {
        try {
            const res = await fetch(KILLSWITCH_URL, { cache: "no-store" });
            const text = (await res.text()).trim();
            if (text === "yes") {
                triggerKillSwitch();
            }
        } catch (e) {
            // ignore errors
        }
    }

    // Check every 10 seconds
    setInterval(checkKillSwitch, 10000);
</script>

</body>
</html>
